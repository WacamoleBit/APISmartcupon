<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="promocion">
    
    <insert id="registrarPromocion" parameterType="modelo.pojo.DatosRegistroPromocion" statementType="CALLABLE">
        {CALL registrarPromocion (
            #{promocion.nombre, mode=IN, jdbcType=VARCHAR},
            #{promocion.descripcion, mode=IN, jdbcType=VARCHAR},
            #{promocion.imagen, mode=IN, jdbcType=BLOB},
            #{promocion.fechaInicio, mode=IN, jdbcType=VARCHAR},
            #{promocion.fechaTermino, mode=IN, jdbcType=VARCHAR},
            #{promocion.restricciones, mode=IN, jdbcType=VARCHAR},
            #{promocion.tipoPromocion, mode=IN, jdbcType=INTEGER},
            #{promocion.porcentajeDescuento, mode=IN, jdbcType=INTEGER},
            #{promocion.categoria, mode=IN, jdbcType=INTEGER},
            #{promocion.maximoCupones, mode=IN, jdbcType=INTEGER},
            #{promocion.codigoPromocion, mode=IN, jdbcType=VARCHAR},
            #{promocion.empresa, mode=IN, jdbcType=INTEGER},
            
            #{filasAfectadas, mode=INOUT, jdbcType=INTEGER},
            #{error, mode=INOUT, jdbcType=VARCHAR}
        )}
    </insert>

    <update id="modificarPromocion" parameterType="modelo.pojo.DatosRegistroPromocion" statementType="CALLABLE">
        {CALL modificarPromocion (
            #{promocion.idPromocion, mode=IN, jdbcType=INTEGER},
            #{promocion.nombre, mode=IN, jdbcType=VARCHAR},
            #{promocion.descripcion, mode=IN, jdbcType=VARCHAR},
            #{promocion.imagen, mode=IN, jdbcType=BLOB},
            #{promocion.fechaInicio, mode=IN, jdbcType=VARCHAR},
            #{promocion.fechaTermino, mode=IN, jdbcType=VARCHAR},
            #{promocion.restricciones, mode=IN, jdbcType=VARCHAR},
            #{promocion.tipoPromocion, mode=IN, jdbcType=INTEGER},
            #{promocion.porcentajeDescuento, mode=IN, jdbcType=INTEGER},
            #{promocion.categoria, mode=IN, jdbcType=INTEGER},
            #{promocion.cuponesDisponibles, mode=IN, jdbcType=INTEGER},
            #{promocion.codigoPromocion, mode=IN, jdbcType=VARCHAR},
            #{promocion.estatus, mode=IN, jdbcType=INTEGER},
            #{promocion.empresa, mode=IN, jdbcType=INTEGER},
            
            #{filasAfectadas, mode=INOUT, jdbcType=INTEGER},
            #{error, mode=INOUT, jdbcType=VARCHAR}
        )}
    </update>
    
    <select id="obtenerPromociones" resultType="modelo.pojo.Promocion">
        SELECT p.idPromocion, p.nombre, p.descripcion, p.fechaInicio, p.fechaTermino, 
            p.restricciones, p.tipoPromocion, tp.nombre as tipoPromocionNombre, 
            p.porcentajeDescuento, p.categoria, c.nombre as nombreCategoria,
            p.cuponesDisponibles, p.codigoPromocion, p.estatus, es.nombre as estatusNombre, 
            p.empresa, em.nombreComercial as empresaNombre FROM promocion p
            INNER JOIN tipoPromocion tp ON p.tipoPromocion = tp.idTipoPromocion
            INNER JOIN categoriapromocion c ON p.categoria = c.idCategoria
            INNER JOIN estatus es ON p.estatus = es.idEstatus
            INNER JOIN empresa em ON p.empresa = em.idEmpresa;
    </select>
</mapper>
